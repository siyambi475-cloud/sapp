<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Siam Admin - Auto Fixer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">
    <div class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg">
        <h2 class="text-2xl font-bold mb-6 text-indigo-600 text-center">ভিডিও আপলোড (Siam App)</h2>
        <div class="space-y-4">
            <input type="text" id="title" placeholder="ভিডিওর নাম" class="w-full p-3 border rounded-lg">
            <input type="text" id="vUrl" placeholder="ইউটিউব/ফেসবুক লিঙ্ক" class="w-full p-3 border rounded-lg">
            <input type="text" id="thumbUrl" placeholder="থাম্বনেইল লিঙ্ক (.jpg / .png)" class="w-full p-3 border rounded-lg">
            <button onclick="addVideo()" id="btn" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold">আপলোড করুন</button>
        </div>
    </div>

    <script>
        // নিচের এই লাইনে ghp_ দিয়ে শুরু হওয়া আপনার একদম নতুন টোকেনটি বসান
        const TOKEN = 'এখানে_আপনার_নতুন_টোকেন_বসান'; 
        const USER = 'siyambi475-cloud';
        const REPO = 'sapp';

        function fixLink(url) {
            if (url.includes("youtu.be/")) {
                let id = url.split("youtu.be/")[1].split("?")[0];
                return `https://www.youtube.com/embed/${id}`;
            }
            if (url.includes("youtube.com/watch")) {
                let id = url.split("v=")[1].split("&")[0];
                return `https://www.youtube.com/embed/${id}`;
            }
            if (url.includes("facebook.com")) {
                return `https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(url)}&show_text=0`;
            }
            return url;
        }

        async function addVideo() {
            const btn = document.getElementById('btn');
            const title = document.getElementById('title').value;
            const rawUrl = document.getElementById('vUrl').value;
            const thumb = document.getElementById('thumbUrl').value;

            if(!title || !rawUrl) return alert("সব তথ্য দিন!");
            btn.innerText = "আপলোড হচ্ছে...";
            btn.disabled = true;

            const finalUrl = fixLink(rawUrl);

            try {
                const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/database.json`, {
                    headers: { 'Authorization': `token ${TOKEN}` }
                });
                const data = await res.json();
                const content = JSON.parse(atob(data.content));
                
                content.push({ 
                    id: Date.now(), 
                    title: title, 
                    url: finalUrl, 
                    thumbnail: thumb, 
                    views: 0 
                });

                const update = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/database.json`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${TOKEN}` },
                    body: JSON.stringify({
                        message: "Video Added",
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(content)))),
                        sha: data.sha
                    })
                });

                if(update.ok) {
                    alert("সাফল্যের সাথে অ্যাড হয়েছে!");
                    location.reload();
                } else {
                    alert("টোকেন ব্লক হয়েছে! নতুন টোকেন লাগবে।");
                }
            } catch (e) { 
                alert("এরর: " + e.message);
            } finally {
                btn.innerText = "আপলোড করুন";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
