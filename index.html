<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siam Video App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .video-card:hover { transform: translateY(-5px); transition: 0.3s; }
    </style>
</head>
<body class="bg-gray-900 text-white p-4">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center text-indigo-400 my-6">Siam Video App</h1>
        
        <input type="text" id="searchInput" onkeyup="searchVideos()" placeholder="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." 
               class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:outline-none focus:border-indigo-500 mb-8">

        <div id="videoGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <p class="text-center col-span-full text-gray-400">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
    </div>

    <script>
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡¶ø‡¶ü‡¶π‡¶æ‡¶¨‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶®
        const GITHUB_TOKEN = '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; 
        const REPO_OWNER = 'siyambi475-cloud';
        const REPO_NAME = 'sapp';
        const FILE_PATH = 'database.json';

        let allVideos = [];

        // ‡¶ó‡¶ø‡¶ü‡¶π‡¶æ‡¶¨ ‡¶•‡ßá‡¶ï‡ßá ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ
        async function loadVideos() {
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
                    headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
                });
                const data = await res.json();
                allVideos = JSON.parse(atob(data.content));
                renderVideos(allVideos);
            } catch (error) {
                console.error("‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá:", error);
            }
        }

        // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
        function renderVideos(videos) {
            const grid = document.getElementById('videoGrid');
            if (videos.length === 0) {
                grid.innerHTML = '<p class="text-center col-span-full text-gray-500">‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>';
                return;
            }
            grid.innerHTML = videos.map(v => `
                <div class="video-card bg-gray-800 rounded-xl overflow-hidden shadow-lg cursor-pointer border border-gray-700" onclick="playVideo(${v.id})">
                    <img src="${v.thumbnail}" class="w-full h-44 object-cover" onerror="this.src='https://via.placeholder.com/300x150?text=No+Thumbnail'">
                    <div class="p-4">
                        <h3 class="font-bold text-lg truncate">${v.title}</h3>
                        <div class="flex justify-between items-center mt-2 text-sm text-gray-400">
                            <span>üëÅÔ∏è ${v.views || 0} views</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function searchVideos() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allVideos.filter(v => v.title.toLowerCase().includes(term));
            renderVideos(filtered);
        }

        // ‡¶≠‡¶ø‡¶â ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶è‡¶¨‡¶Ç ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
        async function playVideo(id) {
            const videoIndex = allVideos.findIndex(v => v.id === id);
            if (videoIndex === -1) return;

            // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
            window.open(allVideos[videoIndex].url, '_blank');

            // ‡¶≠‡¶ø‡¶â ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡ßß ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã
            allVideos[videoIndex].views = (allVideos[videoIndex].views || 0) + 1;

            // ‡¶ó‡¶ø‡¶ü‡¶π‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
                    headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
                });
                const data = await res.json();
                
                await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: "View count updated",
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(allVideos, null, 2)))),
                        sha: data.sha
                    })
                });
                renderVideos(allVideos); // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶≠‡¶ø‡¶â ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            } catch (e) {
                console.error("‡¶≠‡¶ø‡¶â ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
            }
        }

        loadVideos();
    </script>
</body>
</html>
